# =============================================================================
# Skin Lesion Classification Configuration
# =============================================================================
# EfficientNet-V2 based classifier for HAM10000 dataset

# -----------------------------------------------------------------------------
# Data Configuration
# -----------------------------------------------------------------------------
data:
  root: data/HAM10000
  images_dir: data/HAM10000/images
  labels_csv: data/HAM10000/labels.csv
  val_size: 0.15
  test_size: 0.15
  lesion_aware: true        # Prevent lesion-level data leakage

# -----------------------------------------------------------------------------
# Model Configuration
# -----------------------------------------------------------------------------
model:
  name: efficientnet_v2
  size: small
  num_classes: 7
  image_size: 224
  pretrained: true
  head_type: acrnn          # Attention-based Conv Recurrent NN classification head
  dropout_rate: 0.35        # ↓ Reduced (was choking learning at 0.65)
  freeze_backbone: false

# -----------------------------------------------------------------------------
# Training Configuration
# -----------------------------------------------------------------------------
training:
  seed: 42
  batch_size: 48    
  epochs: 40                # ↑ Give model time to converge
  lr: 0.0003                # ↑ Better for EfficientNet fine-tuning
  weight_decay: 0.02        # ↓ Balanced L2 regularization
  num_workers: 4
  use_amp: false            # MPS doesn't support AMP efficiently
  use_torch_compile: false  # Disabled for MPS (backward pass issues)
  use_weighted_sampling: true
  fast_mode: true           # Disable deterministic operations for speed
  augmentation: medium
  early_stopping_patience: 6
  prefetch_factor: 2        # Prefetch batches for better pipeline
  persistent_workers: true  # Keep workers alive between epochs

  # Learning Rate Scheduler
  scheduler:
    type: cosine
    T_0: 20
    T_mult: 1
    eta_min: 0.00001
    warmup_pct: 0.05

# -----------------------------------------------------------------------------
# Loss Function
# -----------------------------------------------------------------------------
loss:
  type: cross_entropy
  label_smoothing: 0.05     # ↓ Prevents overconfidence without suppressing signal

# -----------------------------------------------------------------------------
# Data Augmentation (Dermatoscopy-Safe)
# -----------------------------------------------------------------------------
augmentation:
  enabled: true
  intensity: medium
  techniques:
    - random_horizontal_flip: 0.5
    - random_vertical_flip: 0.3
    - random_rotation: 25
    - color_jitter:
        brightness: 0.2
        contrast: 0.2
        saturation: 0.2
        hue: 0.1
    - gaussian_blur: 0.1
    - random_affine:
        degrees: 15
        translate: 0.1
        scale: [0.9, 1.1]
    - cutout: 0.1

# -----------------------------------------------------------------------------
# Evaluation Configuration
# -----------------------------------------------------------------------------
evaluation:
  batch_size: 96
  metrics:
    - accuracy
    - precision
    - recall
    - f1_score
    - roc_auc
    - confusion_matrix

# -----------------------------------------------------------------------------
# Output Configuration
# -----------------------------------------------------------------------------
output:
  save_best_only: true
  log_interval: 10
  save_training_history: true


